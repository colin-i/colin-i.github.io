
<script type="module">
import { Octokit } from "https://cdn.skypack.dev/@octokit/core";

const octokit = new Octokit({
  auth: 'github_pat_'+'11ACTLOTY0hEfZBPtCUcq9_JO1u7Gf70NNbzL7bZhQPhTcVwsuiqbdWjdCHXfEr5PwR2RM5SYD4XmFbtll'
			//it expires if pushed without +
});

function btod(b){
	var obj=atob(b);
	var score = obj.charCodeAt(0) | (obj.charCodeAt(1) << 8) | (obj.charCodeAt(2) << 16) | (obj.charCodeAt(3) << 24);
	obj=obj.slice(4);
	for(var i=0;i<obj.length;i++){
		if(obj.charCodeAt(i)==0){
			var name=obj.substr(0,i);
			obj=obj.slice(i+1);
			break;
		}
	}
	for(var i=0;i<obj.length;i++){
		if(obj.charCodeAt(i)==0){
			var comment=obj.substr(0,i);
			obj=obj.slice(i+1);
			break;
		}
	}
	var timeleft = obj.charCodeAt(0) | (obj.charCodeAt(1) << 8) | (obj.charCodeAt(2) << 16) | (obj.charCodeAt(3) << 24);
	obj=obj.slice(4);
	var timeright = obj.charCodeAt(0) | (obj.charCodeAt(1) << 8) | (obj.charCodeAt(2) << 16) | (obj.charCodeAt(3) << 24);
	var time = 2**32*timeright + timeleft;
}

const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);

if(urlParams.has('game_name')){
	const game = urlParams.get('game_name')
	var obj=await octokit.request("GET /repos/colin-i/experimental/contents/recent/"+game, {});
	var recent=atob(obj.data.content);
	obj=await octokit.request("GET /repos/colin-i/experimental/contents/recent/"+game+".tot", {});
	var recentsum=atob(obj.data.content);
	obj=await octokit.request("GET /repos/colin-i/experimental/contents/last/"+game, {});
	var last=atob(obj.data.content);
	obj=await octokit.request("GET /repos/colin-i/experimental/contents/last/"+game+".tot", {});
	var lastsum=atob(obj.data.content);
	obj=await octokit.request("GET /repos/colin-i/experimental/contents/data/"+game, {});
	var alltime=atob(obj.data.content);
	obj=await octokit.request("GET /repos/colin-i/experimental/contents/datasum/"+game+".tot", {});
	var alltimesum=atob(obj.data.content);
	if(urlParams.has('score_text')){
		const name = urlParams.get('name_text')
		const score = urlParams.get('score_text')
		const comment = urlParams.get('comment_text')
	
		await octokit.request('POST /repos/colin-i/experimental/actions/workflows/39687662/dispatches', {
			ref: 'main',
			inputs: {
				game: game,
				name: name,
				score: score,
				comment: comment
			}
		})
	}
}
</script>

<a href="#" onclick="history.back()">Click here to go back</a>

<!-- alltime/month (top 25 + total) -->
<!-- name/score/comment/date -->
